export const description = 'Conoce ACH y el proceso de ACH Return.';

# ACH Débito Bancario

ACH (Automated Clearing House) es un sistema de transferencias electrónicas que permite mover fondos directamente entre cuentas bancarias. Es ampliamente utilizado en EE.UU. y Puerto Rico para pagos recurrentes, nóminas y facturas, entre otros. Al ofrecer ACH en su comercio, facilita pagos de clientes de manera segura, confiable y a costos bajos, lo que mejora la experiencia de pago y reduce el tiempo de procesamiento. {{ className: 'lead' }}

## Retorno ACH

Un retorno de ACH ocurre cuando un débito o transferencia no puede completarse exitosamente. En Puerto Rico, las transacciones ACH quedan aprobadas inicialmente, pero el procesamiento y débito efectivo de los fondos ocurre 1 o 2 días hábiles después de la aprobación. Durante este período, la transacción puede fallar por diversas razones, generando así un retorno de ACH.

**¿Por qué ocurren los retornos de ACH?**

Los retornos de ACH ocurren cuando el débito no puede completarse debido a factores como fondos insuficientes en la cuenta del cliente, cuenta cerrada, información de cuenta incorrecta o desactualizada, o transacción no autorizada. Cada retorno incluye un código específico que indica la razón exacta del fallo.

**¿Cómo se identifica un retorno de ACH?**

Un retorno de ACH se identifica por su tipo de transacción marcado como “Devolución”, junto con datos de retorno como el código que señala el motivo del fallo.

**¿Dónde puedo consultar los retornos de ACH en Placetopay?**

Los retornos de ACH pueden visualizarse en el panel administrativo de Placetopay, donde se muestra el estado de cada transacción y los detalles específicos de los retornos. Además, se puede exportar esta información en un archivo descargable.

Para integraciones automatizadas, Placetopay también ofrece una API que permite a sistemas externos consultar los retornos ocurridos, permitiendo que los comercios integren esta información directamente en sus sistemas de gestión.

### Identificación y Clasificación de Retornos de ACH

En Placetopay, los retornos de ACH son fáciles de identificar gracias a los códigos de retorno que explican la causa del fallo. Estos códigos se generan automáticamente y permiten clasificar el tipo de problema.

Principales Códigos de Retorno:

* R01 - Fondos insuficientes: La cuenta del cliente no tiene saldo suficiente para completar la transacción.
* R02 - Cuenta cerrada: La cuenta bancaria del cliente ya no está activa.
* R03 - No se puede localizar la cuenta: La información de cuenta proporcionada es incorrecta o desactualizada.

## Consulta de Retornos ACH

Para vizualizar tus transacciones ACH debes ingresar a Panel Placetopay con tu cuenta y permisos de usuario. Considerese la siguiente información:

### Transacción principal

Además de poder ver las transacciones de retorno, también podrás identificar la transacción principal con los siguientes datos:

* El estado de la transacción se mantiene como ”APROBADA”
* El tipo de transacción ahora se identifica como “Reversada”. Esto significa que fue anulada por el retorno y no se debe contar como una transacción finalizada y débitada.
* En el detalle de la transacción, aparece una sección de “Lista de Reembolsos”, donde se encuentra el retorno referente

### Transacción de retorno

La transacción de retorno mantiene datos escenciales de la transacción principal como monto, moneda, identificador de terminal, etc, junto con algunas diferencias:

* El “Tipo de transacción se identifica como “Devolución“, el cúal señala que es la transacción que anula a la transacción principal
* Se agrega el código de retorno, el cúal específica la razón por la que ocurrio el retorno, ejemplo R01: Fondos insuficientes
* Además en la sección “Detalle transaccional” se añaden algunos datos adicionales propios del proceso de retorno como:

| Dato Adicional              | Descripción                                                                                                                                                                                                                                     |
|-----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **collectionId**            | Identificador único que agrupa la transacción para el comercio. Este ID permite vincular la transacción original con sus registros asociados. |
| **returnId**                | Número de secuencia de la addenda (Addenda Sequence Number) del registro de retorno en el archivo NACHA.  |
| **returnData**              | Número de rastreo original de la transacción de entrada (Original Entry Trace Number) en el registro de addenda del retorno.  |
| **originalTransactionDate** | Fecha en que se procesó la transacción original (Effective Entry Date) en el sistema del comercio.    |
| **processBatchId**          | Número secuencial del lote (Batch Number) en el archivo NACHA que contiene el retorno. El ID de lote facilita la gestión de múltiples transacciones y retornos en un solo archivo, vinculando el retorno con el lote de procesamiento original. |
| **bankRoutingNumber**       | Número de ruta del banco receptor (Receiving DFI Identification) en la transacción de retorno. Este código identifica de forma única a la institución financiera que recibe el débito, asegurando precisión en la transacción.                 |
| **clientBankAccountNumber** | Número de cuenta del cliente en la institución financiera (DFI Account Number). Este dato es esencial para el procesamiento y verificación de la cuenta específica de la cual se intentó el débito original.                                    |


## Reporte de Retornos ACH

Desde el Panel administrativo, en el módulo de “Transacciones”, en la sección “Exportar Transacciones” podrás generar un reporte de los retornos ACH de tus sitios.

Para generar el reporte de retornos debes seleccionar la opción “Exportación EBUS ACH Returns”. Este es el tipo de reporte que incluye los datos adicionales de retornos ACH.

A continuación, podrás seleccionar algunos filtros como: rango de fechas, filtro por comercio y sitio, modo de pruebas, el comercio y el sitio. Una vez realizado el exporte, este tomará unos momentos en ser generado para posteriormente ser descargado. 

El reporte geneará un archivo con el formato de nombre ´ebus_ach_return_(fecha)(hora).csv´ donde contendrá los valores separados por punto y coma (;).

A continuación un ejemplo de un archivo de retorno:

```txt {{ 'title': 'ebus_ach_return_202410210746.csv' }}
id;date;currency_code;amount;approval_code;transaction_id;reason_code;reason_code_description;retail_code;collection_id;terminal_number;customer_account_number;return_id;return_data;original_transaction_date;batch;return_date;process_batch_id;internal_reference;bank_routing_number;client_bank_account_number;shopper_name;shopper_email
95c08b439cdec6615e597a5debf513f5;2024-10-21 11:23:04;USD;30.00;614761;;R03;"No hay cuenta, no se puede localizar la cuenta";4682313740133;0987654221;00990101;1234567812;0201;021502010000123;2024-10-21 11:22:48;000295001;2024-10-21 00:00:00;0000001;8;02150201;78007622302;;an*******@yopmail.com
4b723155271444d0952a9f5372d61a01;2024-10-21 11:23:04;USD;30.00;614761;;R02;"Cuenta cerrada";4682313740133;0987654221;00990101;1234567812;0201;021502010000123;2024-10-21 11:23:04;000295001;2024-10-21 00:00:00;0000001;9;02150201;78007622302;;an*******@yopmail.com
```

Este reporte lo puedes importar en tu herramienta favorita para analizar y gestionar los datos.

| id                                   | date                | currency_code | amount | approval_code | transaction_id | reason_code | reason_code_description                     | retail_code     | collection_id | terminal_number | customer_account_number | return_id | return_data        | original_transaction_date | batch     | return_date         | process_batch_id | internal_reference | bank_routing_number | client_bank_account_number | shopper_name | shopper_email              |
|--------------------------------------|---------------------|---------------|--------|---------------|----------------|-------------|---------------------------------------------|-----------------|---------------|-----------------|-------------------------|-----------|--------------------|---------------------------|-----------|----------------------|------------------|--------------------|---------------------|----------------------------|--------------|---------------------------|
| 95c08b439cdec6615e597a5debf513f5     | 2024-10-21 11:23:04 | USD           | 30.00  | 614761        |                | R03         | No hay cuenta, no se puede localizar la cuenta | 4682313740133   | 0987654221    | 00990101        | 1234567812             | 0201      | 021502010000123    | 2024-10-21 11:22:48        | 000295001 | 2024-10-21 00:00:00  | 0000001          | 8                  | 02150201           | 78007622302               |              | an*******@yopmail.com     |
| 4b723155271444d0952a9f5372d61a01     | 2024-10-21 11:23:04 | USD           | 30.00  | 614761        |                | R02         | Cuenta cerrada                       | 4682313740133   | 0987654221    | 00990101        | 1234567812             | 0201      | 021502010000123    | 2024-10-21 11:23:04        | 000295001 | 2024-10-21 00:00:00  | 0000001          | 9                  | 02150201           | 78007622302               |              | an*******@yopmail.com     |


## Reportes vía API

Actualmente hay una API de reporte de transacciones, el cual permite obtener transacciones respectivas a un sitio. Se pretende que como comercio, mediante un sistema se pueda automatizar el flujo de información y facilitando el procesamiento de datos sin intervención manual.

### Generación de reporte

Para generar el reporte, use el endpoint de Request transaction report con el filtro de `type:[”CHARGEBACK”]` para obtener las transacciones de devolución.

Ejemplo:

```json
{
  "locale": "es_CO",
    "auth": {
        "login":"login",
        "tranKey":"trankey",
        "nonce":"nounce",
        "seed":"2023-06-08T14:59:34-05:00"
    },
    "filters": {
        "startDate": "2023-06-07 14:59:34",
        "endDate": "2023-06-08 14:59:34",
        "type": ["CHARGEBACK"]
    },
    "callbackUrl": "https://dnetix.co/ping/report"
}
```

### Obtención del reporte

Una vez creado el reporte, esperar un momento en lo que es generado y consultarlo mediante [Get transaction report](https://docs.placetopay.dev/gateway/api/reference/transaction#query-request)

En este reporte obtendrá transacciones diferenciadas con el campo “type”. 

```txt
id date transaction_date reference currency_code amount tax payment_method internal_reference status reason merchant terminal authorization refunded installments last_digits bank_currency bank_factor bank_amount issuer_name payer_document payer_first_name payer_last_name payer_email ip_address batch_number line_number type
1b96d8414e66ae65fcf5224fb09e3d34 2024-10-21T11:22:44-05:00 2024-10-21T11:22:44-05:00 OCT_15_TEST_RETURN_4 USD 30 0 EBACH 3 APPROVED 00 4682313740133 00990101 614761    USD 1 30   Andres l  andres2@yopmail.com 127.0.0.1 000295001 CHARGEBACK
22e71570373e8e579d8bdf7ef4f0dd20 2024-10-21T11:22:12-05:00 2024-10-21T11:22:12-05:00 OCT_15_TEST_RETURN_4 USD 30 0 EBACH 2 APPROVED 00 4682313740133 00990101 614761    USD 1 30   Andres l  andres2@yopmail.com 127.0.0.1 000295001 CHARGEBACK "callbackUrl": "https://dnetix.co/ping/report"
```

> En este reporte se incluye información básica de la transacción, para obtener más información avanzada, debes consultar cada transacción por separado