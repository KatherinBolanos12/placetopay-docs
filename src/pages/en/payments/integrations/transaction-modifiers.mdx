export const description = 'Learn about transaction modifiers';

# Transaction Modifiers
Transaction modifiers are configurations at the site level that affect the flow of a transaction according to the defined modifier type. Currently, only the "Fee" option is available.

## Fee Type Modifier
This type of transaction modifier applies an additional fee or commission to the original cost of the requested transaction according to the defined configurations. This modifier only applies to payment methods that support dispersion, as the charge is made through a [dispersion](/en/gateway/transaction-types#dispersion) to the site or agreement configured in the transaction modifier.

### Fee Type Modifier Configurations
- **Agreement**: Identifier of the site to which the commission corresponding to the transaction cost will be sent.
- **Fixed Amount**: Fixed value of the commission that will be added to the original transaction cost.
- **Percentage Amount**: Percentage that will be added to the fee calculated based on the original transaction.
- **Apply Tax**: Defines whether VAT will be applied to the additional cost generated by the transaction.

### How to Integrate?
The fee type transaction modifier is supported through our API [Web Checkout](/en/checkout), which allows integrating various payment methods and payment types compatible with this modifier.

### How is the Fee of a Transaction Calculated?
The fee calculation is performed considering the currency configured in the site or sites associated with the fee type transaction modifier. Before performing the calculation, the currencies of the request and the site configured with the modifier are validated. For example, if the site's currency is `USD` and does not match the request's currency `COP`, the configured **Fixed Amount** will be converted from `USD` to `COP`, using the conversion rate at the time of the request.

Once the currencies are validated, the calculated commission is broken down based on the original transaction amount into the [additional fields](/en/checkout/additional-fields) of the original request sent by the site. These fields include **Subtotal**, **Transaction Cost**, and, if the transaction modifier has the **Apply Tax** option enabled, **VAT on Transaction Cost** will also be added. These descriptions do not support language changes and are created based on the language sent in the site's first request.

### Examples of Application of the Fee Type Transaction Modifier

**Basic Payments**
[Basic payments](/en/checkout/create-session#basic-payment) are modified and become a [dispersion payment](/en/checkout/create-session#dispersion-payment). The first dispersion contains the original amount of the site's request, while the second dispersion includes the transaction costs plus the corresponding tax of the configured transaction modifier.

* Fixed Amount: 0.35
* Percentage Amount: 5%
* Apply Tax: Yes (10% is obtained from the tax configured in the site)

Original site request:

```json
{
  ...
  "payment": {
      "reference": "test_basic_payment",
      "description": "basic_payment",
      "amount": { "currency": "USD", "total": 100 },
       ...
    },
  ...
}
```

Result of the request with the application of a transaction modifier:

```json
{
  ...
  "payment": {
      "reference": "test_basic_payment",
      "description": "basic_payment",
      "amount": { "currency": "USD", "total": 105.89 },
      "dispersion": [ 
        {
          "agreement": 1 // site identifier making the request.
          "agreementType": "MERCHANT",
          "amount": { "currency": "USD", "total": 100 }  
        },
        {
          "agreement": 14 // configured site agreement for the request.
          "agreementType": "MERCHANT",
          "amount": { "currency": "USD", "total": 5.89 }  
        }
      ],
      "fields": [
          {"value": "US$ 100.00", "keyword": "Subtotal", "displayOn": "both"},
          {"value": "US$ 5.35", "keyword": "Transaction Cost", "displayOn": "both"},
          {"value": "US$ 0.54", "keyword": "VAT on Transaction Cost", "displayOn": "both"},
        ]
       ...
    },
  ...
}
```

**Partial Payments**
[Partial payments](/en/en/checkout/create-session#partial-payment) do not directly support [dispersion payments](/en/checkout/create-session#dispersion-payment). To apply transaction modifiers, the option to make __partial payments__ is disabled, and the same behavior used previously in basic payments is employed.

**Payments with Dispersions**
For [payments with dispersions](/en/en/checkout/create-session#dispersion-payment), an additional dispersion will be added to those originally sent in the site's request.
 
Each dispersion is linked to an agreement that contains a configured transaction modifier. This will be applied to the base amount of each dispersion, and the total sum of these commissions will be reflected in the new dispersion of the transaction.

> In this case, all the agreements (`agreement`) of the dispersions have the same transaction modifier properties configured.

* Fixed Amount: 0.35
* Percentage Amount: 5%
* Apply Tax: Yes (10% is obtained from the tax configured in the site)

Original site request with two dispersions:

```json
{
  ...
  "payment": {
      "reference": "test_dispersion_payment",
      "description": "dispersion_payment",
      "amount": { "currency": "USD", "total": 100 },
      "dispersion": [ 
        {
          "agreement": 1,
          "agreementType": "MERCHANT",
          "amount": { "currency": "USD", "total": 50 }  
        },
        {
          "agreement": 2,
          "agreementType": "MERCHANT",
          "amount": {  "currency": "USD", "total": 25 }  
        },
        {
          "agreement": 3,
          "agreementType": "MERCHANT",
          "amount": {  "currency": "USD", "total": 25 }  
        }
      ]
    },
  ...
}
```

Result of the request with the application of a transaction modifier:

```json
{
  ...
  "payment": {
      "reference": "test_dispersion_payment",
      "description": "dispersion_payment",
      "amount": { "currency": "USD", "total":  113.15 },
      "dispersion": [ 
        {
          "agreement": 1
          "agreementType": "MERCHANT",
          "amount": { "currency": "USD", "total": 50 }  
        },
        {
          "agreement": 2
          "agreementType": "MERCHANT",
          "amount": {  "currency": "USD", "total": 25 }  
        },
        {
          "agreement": 3
          "agreementType": "MERCHANT",
          "amount": {  "currency": "USD", "total": 25 }  
        }
        {
          "agreement": 14 // configured site agreement for the request.
          "agreementType": "MERCHANT",
          "amount": {  "currency": "USD", "total": 13.15 }  
        }
      ],
      "fields": [
          {"value": "US$ 100.00", "keyword": "Subtotal", "displayOn": "both"},
          {"value": "US$ 11.05", "keyword": "Transaction Cost", "displayOn": "both"},
          {"value": "US$ 2.10", "keyword": "VAT on Transaction Cost", "displayOn": "both"},
        ]
    },
  ...
}
```

## FAQs
<details>
<summary>How do I configure a transaction modifier for a site?</summary>
<p>request must be made to our operations team through Helpdesk, either for the creation of a new site or for modifying an existing one, including transaction modifier configurations.</p>
</details>

<details>
<summary>How can transaction modifier payments be visualized?</summary>
<h4>Basic Payment</h4>
<p>In the transaction panel, a transaction with the original requested amount can be viewed, along with additional transactions showing the commission for the original transaction cost.</p>
<h4>Payment with Dispersions</h4>
<p>In the transaction panel, the transactions along with their original dispersions and amounts can be viewed. Additionally, a new dispersion is included that groups the commissions for each transaction cost from the requested dispersions.</p>
</details>

<details>
<summary>How many dispersions can be sent with payment modifiers?</summary>
<p>The current configuration allows a maximum of 3 dispersions for all countries, and 4 for Ecuador. It is important to consider that since the transaction modifier adds an additional transaction to collect the commission, the maximum allowed is 3 dispersions in the request for Ecuador and 2 for other countries.</p>
</details>